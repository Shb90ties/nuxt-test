'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Sticky=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'',c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,a),this.selector=b,this.elements=[],this.version='1.2.0',this.vp=this.getViewportSize(),this.body=document.querySelector('body'),this.options={wrap:c.wrap||!1,marginTop:c.marginTop||0,stickyFor:c.stickyFor||0,stickyClass:c.stickyClass||null,stickyContainer:c.stickyContainer||'body'},this.updateScrollTopPosition=this.updateScrollTopPosition.bind(this),this.updateScrollTopPosition(),window.addEventListener('load',this.updateScrollTopPosition),window.addEventListener('scroll',this.updateScrollTopPosition),this.run()}return _createClass(a,[{key:'run',value:function run(){var b=this;this.pageLoadedInterval=setInterval(function(){if('complete'===document.readyState){clearInterval(b.pageLoadedInterval);var c=document.querySelectorAll(b.selector);b.forEach(c,function(d){return b.renderElement(d)})}},100)}},{key:'renderElement',value:function renderElement(b){var c=this;b.sticky={},b.sticky.active=!1,b.sticky.marginTop=parseInt(b.getAttribute('data-margin-top'))||this.options.marginTop,b.sticky.stickyFor=parseInt(b.getAttribute('data-sticky-for'))||this.options.stickyFor,b.sticky.stickyClass=b.getAttribute('data-sticky-class')||this.options.stickyClass,b.sticky.wrap=!!b.hasAttribute('data-sticky-wrap')||this.options.wrap,b.sticky.stickyContainer=this.options.stickyContainer,b.sticky.container=this.getStickyContainer(b),b.sticky.container.rect=this.getRectangle(b.sticky.container),b.sticky.rect=this.getRectangle(b),'img'===b.tagName.toLowerCase()&&(b.onload=function(){return b.sticky.rect=c.getRectangle(b)}),b.sticky.wrap&&this.wrapElement(b),this.activate(b)}},{key:'wrapElement',value:function wrapElement(b){b.insertAdjacentHTML('beforebegin','<span></span>'),b.previousSibling.appendChild(b)}},{key:'activate',value:function activate(b){b.sticky.rect.top+b.sticky.rect.height<b.sticky.container.rect.top+b.sticky.container.rect.height&&b.sticky.stickyFor<this.vp.width&&!b.sticky.active&&(b.sticky.active=!0),0>this.elements.indexOf(b)&&this.elements.push(b),b.sticky.resizeEvent||(this.initResizeEvents(b),b.sticky.resizeEvent=!0),b.sticky.scrollEvent||(this.initScrollEvents(b),b.sticky.scrollEvent=!0),this.setPosition(b)}},{key:'initResizeEvents',value:function initResizeEvents(b){var c=this;b.sticky.resizeListener=function(){return c.onResizeEvents(b)},window.addEventListener('resize',b.sticky.resizeListener)}},{key:'destroyResizeEvents',value:function destroyResizeEvents(b){window.removeEventListener('resize',b.sticky.resizeListener)}},{key:'onResizeEvents',value:function onResizeEvents(b){this.vp=this.getViewportSize(),b.sticky.rect=this.getRectangle(b),b.sticky.container.rect=this.getRectangle(b.sticky.container),b.sticky.rect.top+b.sticky.rect.height<b.sticky.container.rect.top+b.sticky.container.rect.height&&b.sticky.stickyFor<this.vp.width&&!b.sticky.active?b.sticky.active=!0:(b.sticky.rect.top+b.sticky.rect.height>=b.sticky.container.rect.top+b.sticky.container.rect.height||b.sticky.stickyFor>=this.vp.width&&b.sticky.active)&&(b.sticky.active=!1),this.setPosition(b)}},{key:'initScrollEvents',value:function initScrollEvents(b){var c=this;b.sticky.scrollListener=function(){return c.onScrollEvents(b)},window.addEventListener('scroll',b.sticky.scrollListener)}},{key:'destroyScrollEvents',value:function destroyScrollEvents(b){window.removeEventListener('scroll',b.sticky.scrollListener)}},{key:'onScrollEvents',value:function onScrollEvents(b){b.sticky.active&&this.setPosition(b)}},{key:'setPosition',value:function setPosition(b){this.css(b,{position:'',width:'',top:'',left:''}),this.vp.height<b.sticky.rect.height||!b.sticky.active||(!b.sticky.rect.width&&(b.sticky.rect=this.getRectangle(b)),b.sticky.wrap&&this.css(b.parentNode,{display:'block',width:b.sticky.rect.width+'px',height:b.sticky.rect.height+'px'}),0===b.sticky.rect.top&&b.sticky.container===this.body?this.css(b,{position:'fixed',top:b.sticky.rect.top+'px',left:b.sticky.rect.left+'px',width:b.sticky.rect.width+'px'}):this.scrollTop>b.sticky.rect.top-b.sticky.marginTop?(this.css(b,{position:'fixed',width:b.sticky.rect.width+'px',left:b.sticky.rect.left+'px'}),this.scrollTop+b.sticky.rect.height+b.sticky.marginTop>b.sticky.container.rect.top+b.sticky.container.offsetHeight?(b.sticky.stickyClass&&b.classList.remove(b.sticky.stickyClass),this.css(b,{top:b.sticky.container.rect.top+b.sticky.container.offsetHeight-(this.scrollTop+b.sticky.rect.height)+'px'})):(b.sticky.stickyClass&&b.classList.add(b.sticky.stickyClass),this.css(b,{top:b.sticky.marginTop+'px'}))):(b.sticky.stickyClass&&b.classList.remove(b.sticky.stickyClass),this.css(b,{position:'',width:'',top:'',left:''}),b.sticky.wrap&&this.css(b.parentNode,{display:'',width:'',height:''})))}},{key:'update',value:function update(){var b=this;this.forEach(this.elements,function(c){c.sticky.rect=b.getRectangle(c),c.sticky.container.rect=b.getRectangle(c.sticky.container),b.activate(c),b.setPosition(c)})}},{key:'destroy',value:function destroy(){var b=this;this.forEach(this.elements,function(c){b.destroyResizeEvents(c),b.destroyScrollEvents(c),delete c.sticky}),clearInterval(this.pageLoadedInterval),delete this.elements}},{key:'getStickyContainer',value:function getStickyContainer(b){for(var c=b.parentNode;!c.hasAttribute('data-sticky-container')&&!c.parentNode.querySelector(b.sticky.stickyContainer)&&c!==this.body;)c=c.parentNode;return c}},{key:'getRectangle',value:function getRectangle(b){this.css(b,{position:'',width:'',top:'',left:''});var c=Math.max(b.offsetWidth,b.clientWidth,b.scrollWidth),d=Math.max(b.offsetHeight,b.clientHeight,b.scrollHeight),e=0,f=0;do e+=b.offsetTop||0,f+=b.offsetLeft||0,b=b.offsetParent;while(b);return{top:e,left:f,width:c,height:d}}},{key:'getViewportSize',value:function getViewportSize(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}},{key:'updateScrollTopPosition',value:function updateScrollTopPosition(){this.scrollTop=(window.pageYOffset||document.scrollTop)-(document.clientTop||0)||0}},{key:'forEach',value:function forEach(b,c){for(var d=0,e=b.length;d<e;d++)c(b[d])}},{key:'css',value:function css(b,c){for(var d in c)c.hasOwnProperty(d)&&(b.style[d]=c[d])}}]),a}();(function(a,b){'undefined'==typeof exports?'function'==typeof define&&define.amd?define([],function(){return b}):a.Sticky=b:module.exports=b})(this,Sticky);